{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">HR Attendance Overview</h2>

<div class="card shadow-sm mb-3">
 <div class="card-body">
   <form class="row g-2 align-items-end" method="get">
     <div class="col-md-5">
       <label class="form-label">Employee</label>
       <select class="form-select" name="user_id">
         <option value="">All employees</option>
         {% for u in users %}
           <option value="{{ u.id }}" {% if selected_user_id == u.id|stringformat:"s" %}selected{% endif %}>
             {{ u.email }} ({{ u.get_role_display }})
           </option>
         {% endfor %}
       </select>
     </div>

     <div class="col-md-4">
       <label class="form-label">Date</label>
       <input class="form-control" name="date" type="date" value="{{ selected_date }}">
     </div>

     <div class="col-md-3 d-flex gap-2">
       <button class="btn btn-dark w-100">Filter</button>
       <a class="btn btn-outline-secondary w-100" href="{% url 'hr_attendance_list' %}">Reset</a>
     </div>
   </form>
 </div>
</div>

<div class="card shadow-sm">
 <div class="table-responsive">
   <table class="table table-hover mb-0 align-middle">
     <thead class="table-light">
       <tr>
         <th>Date</th>
         <th>Employee</th>
         <th>Clock In</th>
         <th>Clock Out</th>
         <th>Total Time</th>
         <th class="text-end">Action</th>
       </tr>
     </thead>
     <tbody>
     {% for r in rows %}
       <tr>
         <td class="fw-semibold">{{ r.date }}</td>
         <td>{{ r.user.email }}</td>
         <td>{% if r.clock_in %}{{ r.clock_in|date:"H:i:s" }}{% else %}-{% endif %}</td>
         <td>{% if r.clock_out %}{{ r.clock_out|date:"H:i:s" }}{% else %}-{% endif %}</td>
         <td>
           {% if r.clock_in and r.clock_out %}
             <span class="badge bg-success">{{ r.total_time }}</span>
           {% elif r.clock_in and not r.clock_out %}
             <span class="badge bg-warning text-dark">In progress</span>
           {% else %}
             <span class="text-muted">-</span>
           {% endif %}
         </td>
         <td class="text-end">
           <a class="btn btn-sm btn-outline-primary" href="{% url 'hr_employee_attendance' r.user.id %}">View</a>
         </td>
       </tr>
     {% empty %}
       <tr><td colspan="6" class="text-center text-muted p-4">No records found.</td></tr>
     {% endfor %}
     </tbody>
   </table>
 </div>
</div>
{% endblock %}
